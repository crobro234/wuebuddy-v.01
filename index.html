<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>WueBuddy | ë·”ë¥´ì¸ ë¶€ë¥´í¬ êµí™˜í•™ìƒ ë„ìš°ë¯¸</title>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');
    * {margin: 0; padding: 0; box-sizing: border-box;}
    html, body {
      font-family: "Noto Sans KR", sans-serif;
      overflow-x: hidden;
      scroll-behavior: smooth;
      background-color: #f7f8fa;
    }
    .btn {
      margin-top: 10px;
      background-color: #0066ff;
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s;
    }
    .btn:hover { background-color: #004bcc; }
    .board {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 25px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      animation: fadeIn 0.8s ease;
    }
    .board h2 { color: #004bcc; margin-bottom: 10px; }
    a.map-link { color: #004bcc; font-weight: bold; text-decoration: none; }
  </style>
</head>
<body>
  <section id="intro4">
    <h1>âœ¨ WueBuddy</h1>
    <button class="btn" onclick="showMain()">ì‹œì‘í•˜ê¸° ğŸš€</button>
  </section>

  <div id="mainContent" style="display:none; padding:20px;">
    <h2 style="text-align:center; color:#333;">ğŸ“š WueBuddy ê²Œì‹œíŒ</h2>

    <!-- ğŸ” ê²€ìƒ‰ ê¸°ëŠ¥ ì¶”ê°€ëœ ì§ˆë¬¸ ë³´ë“œ -->
    <div id="question-board" class="board">
      <h2>ğŸ“‹ ì§ˆë¬¸ ê²Œì‹œíŒ</h2>
      <div style="display:flex; gap:8px; margin:10px 0;">
        <input id="q-search" placeholder="ì˜ˆ: ë¹„ì, Anmeldung, Aufenthaltstitel..." style="flex:1; padding:10px; border:1px solid #ddd; border-radius:8px;">
        <button class="btn" onclick="semanticSearch()">ìœ ì‚¬ê²€ìƒ‰</button>
      </div>
      <div id="q-preview"></div>
    </div>

    <!-- ìº í¼ìŠ¤ë§µ -->
    <div id="campus-board" class="board"></div>

    <!-- Mensa ì‹ë‹¨ -->
    <div id="mensa-board" class="board">
      <h2>ğŸ¥— Mensa ì‹ë‹¨</h2>
      <button class="btn" onclick="toggleMensa()">ë©˜ì ì‹ë‹¨ ë³´ê¸° ğŸ½ï¸</button>
      <div id="mensa-view" style="display:none; margin-top:10px;">
        <iframe src="https://www.swerk-wue.de/wuerzburg/essen-trinken/mensen-speiseplaene/mensa-campus-hubland-sued/menu"
                width="100%" height="600" style="border:0; border-radius:12px;"></iframe>
      </div>
    </div>

    <div id="food-board" class="board"></div>
    <div id="answer-box" class="board" style="display:none;"></div>
  </div>

  <script>
    const API_BASE = window.location.origin;

    function showMain() {
      document.getElementById("intro4").style.display = "none";
      document.getElementById("mainContent").style.display = "block";
      loadQuestionPreview();
    }

    async function loadQuestionPreview() {
      const box = document.getElementById("q-preview");
      box.innerHTML = "<p>ì§ˆë¬¸ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>";
      const res = await fetch(`${API_BASE}/categories`);
      const data = await res.json();
      const all = [];
      for (let c of data.categories) {
        const q = await fetch(`${API_BASE}/questions/${c.id}`);
        const d = await q.json();
        all.push(...d.questions);
      }
      box.innerHTML = `<ul>${all.slice(0,3).map(q=>`<li onclick="loadAnswer(${q.id})">${q.question}</li>`).join("")}</ul>`;
    }

    async function semanticSearch() {
      const q = document.getElementById("q-search").value.trim();
      if (!q) return alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”!");
      const box = document.getElementById("q-preview");
      box.innerHTML = "<p>ğŸ” ì˜ë¯¸ê²€ìƒ‰ ì¤‘...</p>";

      try {
        const res = await fetch(`${API_BASE}/search/semantic?query=`+encodeURIComponent(q));
        const data = await res.json();
        if (!data.results || !data.results.length) {
          box.innerHTML = "<p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
          return;
        }
        box.innerHTML = `<ul>${data.results.map(r=>`
          <li onclick="loadAnswer(${r.id})">${r.question} <small style="color:#888;">(${r.score})</small></li>
        `).join("")}</ul>`;
      } catch {
        box.innerHTML = "<p>ê²€ìƒ‰ ì˜¤ë¥˜ ë°œìƒ.</p>";
      }
    }

    async function loadAnswer(id) {
      const res = await fetch(`${API_BASE}/answer/${id}`);
      const data = await res.json();
      const box = document.getElementById("answer-box");
      box.style.display = "block";
      box.innerHTML = `<h3>ğŸ’¬ ë‹µë³€</h3><p>${data.answer}</p><button class="btn" onclick="back()">â† ëŒì•„ê°€ê¸°</button>`;
    }

    function back() {
      document.getElementById("answer-box").style.display = "none";
      loadQuestionPreview();
    }

    function toggleMensa() {
      const v = document.getElementById("mensa-view");
      v.style.display = v.style.display === "none" ? "block" : "none";
    }
  </script>
</body>
</html>
