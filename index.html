<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>WueBuddy | ë·”ë¥´ì¸ ë¶€ë¥´í¬ êµí™˜í•™ìƒ ë„ìš°ë¯¸</title>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');
    * {margin: 0; padding: 0; box-sizing: border-box;}
    html, body {
      font-family: "Noto Sans KR", sans-serif;
      overflow-x: hidden;
      scroll-behavior: smooth;
      background-color: #f7f8fa;
    }
    section {
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      color: white;
      background-size: cover;
      background-position: center;
      position: relative;
    }
    section::before {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.4);
    }
    section > * { position: relative; z-index: 1; }
    h1 { font-size: 2.8em; margin-bottom: 0.4em; text-shadow: 0 2px 8px rgba(0,0,0,0.5); }
    p { font-size: 1.3em; max-width: 800px; line-height: 1.6; }
    .btn {
      margin-top: 40px;
      background-color: #0066ff;
      border: none;
      color: white;
      padding: 15px 30px;
      font-size: 1.1em;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s;
    }
    .btn:hover { background-color: #004bcc; }
    #intro1 { background-image: url('https://images.unsplash.com/photo-1559305616-3f99c7779865?auto=format&fit=crop&w=1600&q=80'); }
    #intro2 { background-image: url('https://images.unsplash.com/photo-1528909514045-2fa4ac7a08ba?auto=format&fit=crop&w=1600&q=80'); }
    #intro3 { background-image: url('https://images.unsplash.com/photo-1532948488455-68dabc39f023?auto=format&fit=crop&w=1600&q=80'); }
    #intro4 { background-image: url('https://images.unsplash.com/photo-1505761671935-60b3a7427bad?auto=format&fit=crop&w=1600&q=80'); }
    #mainContent {
      display: none;
      min-height: 100vh;
      padding: 40px 20px;
      color: #222;
    }
    .board {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 25px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      animation: fadeIn 0.8s ease;
    }
    .board h2 {
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: #004bcc;
      font-size: 1.4em;
      margin-bottom: 10px;
      border-bottom: 2px solid #e0e0e0;
      padding-bottom: 6px;
    }
    .board ul { list-style: none; text-align: left; }
    .board li {
      padding: 10px 0;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      transition: 0.2s;
    }
    .board li:hover { background: #f2f4ff; padding-left: 10px; }
    #answer-box {
      margin-top: 40px;
      padding: 25px;
      border-radius: 10px;
      background: rgba(255,255,255,0.95);
      color: #333;
      width: 70%;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      display: none;
    }
    a.map-link {
      color: #004bcc;
      font-weight: bold;
      text-decoration: none;
    }
    a.map-link:hover { text-decoration: underline; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    /* ğŸŒ ì–¸ì–´ ì „í™˜ ë²„íŠ¼ */
    #lang-switch {
      position: fixed;
      top: 20px;
      right: 25px;
      font-weight: bold;
      cursor: pointer;
      z-index: 999;
      background: rgba(255,255,255,0.8);
      padding: 6px 10px;
      border-radius: 6px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body>

  <!-- ğŸŒ ì–¸ì–´ ì „í™˜ -->
  <div id="lang-switch">ğŸ‡°ğŸ‡· / ğŸ‡¬ğŸ‡§</div>

  <!-- ğŸ¬ ì¸íŠ¸ë¡œ -->
  <section id="intro1"><h1 data-aos="fade-up">ğŸ‡©ğŸ‡ª ë…ì¼ êµí™˜í•™ìƒì´ ì²˜ìŒì´ì‹ ê°€ìš”?</h1></section>
  <section id="intro2"><h1 data-aos="fade-right">ğŸ“ ê·¸ëŸ°ë° ë·”ë¥´ì¸ ë¶€ë¥´í¬ë¡œ ì˜¤ì‹ ë‹¤ê³ ìš”?</h1><p data-aos="fade-left" data-aos-delay="200">ìƒˆë¡œìš´ ë‚˜ë¼, ìƒˆë¡œìš´ ëŒ€í•™... ì¤€ë¹„í•  ê²Œ ë„ˆë¬´ ë§ì£ .</p></section>
  <section id="intro3"><h1 data-aos="fade-left">ğŸ“š ì–´ë””ì„œë¶€í„° ì•Œì•„ë´ì•¼ í• ì§€ ë§‰ë§‰í•˜ë‹¤ë©´,</h1><p data-aos="fade-right" data-aos-delay="200">ë·”ë¥´ì¸ ë¶€ë¥´í¬ ê²½í—˜ìê°€ ì§ì ‘ ë§Œë“  ê°€ì´ë“œê°€ ë„ì™€ë“œë¦´ê²Œìš”.</p></section>
  <section id="intro4"><h1 data-aos="zoom-in">âœ¨ WueBuddy</h1><p data-aos="fade-up" data-aos-delay="200">ë‹¹ì‹ ì˜ êµí™˜í•™ìƒ ìƒí™œì„ ì‰½ê³  ì¦ê²ê²Œ ë§Œë“¤ì–´ì¤„ ë„ìš°ë¯¸ ì±—ë´‡ì…ë‹ˆë‹¤.</p><button class="btn" data-aos="fade-up" data-aos-delay="400" onclick="showMain()">ì‹œì‘í•˜ê¸° ğŸš€</button></section>

  <!-- ğŸ’¬ ê²Œì‹œíŒ -->
  <div id="mainContent" data-aos="fade-in">
    <h2 style="text-align:center; color:#333; margin-bottom:25px;">ğŸ“š WueBuddy ê²Œì‹œíŒ</h2>

    <div id="question-board" class="board" data-aos="fade-up"></div>
    <div id="campus-board" class="board" data-aos="fade-up"></div>

    <div id="mensa-board" class="board" data-aos="fade-up">
      <h2>ğŸ¥— Mensa ì‹ë‹¨</h2><p>ì˜¤ëŠ˜ì˜ ë©”ë‰´ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
      <button class="btn" onclick="openMensa()">ë©˜ì ì‹ë‹¨ ë³´ëŸ¬ê°€ê¸° ğŸ½ï¸</button>
    </div>

    <!-- ğŸ½ï¸ ë§›ì§‘ (í™•ì¥) -->
    <div id="food-board" class="board" data-aos="fade-up"></div>

    <!-- âœï¸ ììœ ê²Œì‹œíŒ (ê¸°ì¡´ ìœ ì§€) -->
    <div id="free-board" class="board" data-aos="fade-up">
      <h2>âœï¸ ììœ ê²Œì‹œíŒ</h2>
      <form id="postForm" onsubmit="createPost(event)">
        <input type="text" id="postTitle" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required style="width:80%;padding:10px;margin-bottom:8px;border-radius:6px;border:1px solid #ccc;"><br>
        <textarea id="postContent" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" required style="width:80%;height:80px;padding:10px;border-radius:6px;border:1px solid #ccc;"></textarea><br>
        <button type="submit" class="btn">ë“±ë¡í•˜ê¸° âœ¨</button>
      </form>
      <div id="postList" style="margin-top:20px;text-align:left;"></div>
    </div>

    <div id="answer-box" data-aos="fade-up"></div>
  </div>

  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
    AOS.init({ duration: 1000, once: true });
    const API_BASE = window.location.origin;

    /* ========== ì–¸ì–´ ë°ì´í„° & ì „í™˜ ========== */
    let currentLang = 'ko';
    const LANG = {
      ko: {
        intro1: "ğŸ‡©ğŸ‡ª ë…ì¼ êµí™˜í•™ìƒì´ ì²˜ìŒì´ì‹ ê°€ìš”?",
        intro2: "ğŸ“ ê·¸ëŸ°ë° ë·”ë¥´ì¸ ë¶€ë¥´í¬ë¡œ ì˜¤ì‹ ë‹¤ê³ ìš”?",
        intro3: "ğŸ“š ì–´ë””ì„œë¶€í„° ì•Œì•„ë´ì•¼ í• ì§€ ë§‰ë§‰í•˜ë‹¤ë©´,",
        intro4: "âœ¨ WueBuddy",
        intro4sub: "ë‹¹ì‹ ì˜ êµí™˜í•™ìƒ ìƒí™œì„ ì‰½ê³  ì¦ê²ê²Œ ë§Œë“¤ì–´ì¤„ ë„ìš°ë¯¸ ì±—ë´‡ì…ë‹ˆë‹¤.",
        start: "ì‹œì‘í•˜ê¸° ğŸš€",
        boards: {
          question: "ğŸ“‹ ì§ˆë¬¸ ê²Œì‹œíŒ",
          campus: "ğŸ« ìº í¼ìŠ¤ë§µ",
          mensa: "ğŸ¥— Mensa ì‹ë‹¨",
          food: "ğŸ½ï¸ ë§›ì§‘ ì¶”ì²œ"
        },
        more: "ë” ë³´ê¸°",
        back: "â† ëŒì•„ê°€ê¸°",
        mapBtn: "ì§€ë„ë¡œ ë³´ê¸° ğŸ—ºï¸",
        mensaBtn: "ë©˜ì ì‹ë‹¨ ë³´ëŸ¬ê°€ê¸° ğŸ½ï¸",
        noPosts: "ì•„ì§ ì‘ì„±ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.",
        answerTitle: "ë‹µë³€ ğŸ’¬",
        homeBtn: "ì²˜ìŒìœ¼ë¡œ ğŸ”™",
        addMyRestaurant: "ë‚˜ì˜ ë§›ì§‘ ì¶”ê°€ â•",
        addTitle: "ğŸ½ï¸ ë‚˜ì˜ ë§›ì§‘ ì¶”ê°€",
        restNamePh: "ì‹ë‹¹ ì´ë¦„",
        restLinkPh: "Google ì§€ë„ ë§í¬",
        confirmAdd: "ë“±ë¡í•˜ê¸° âœ¨",
        reviewHeader: "í›„ê¸° ë‚¨ê¸°ê¸°",
        reviewPh: "ì½”ë©˜íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”",
        reviewSubmit: "ë“±ë¡",
        avgLabel: "í‰ê· ",
        peopleSuffix: "ëª…"
      },
      en: {
        intro1: "ğŸ‡©ğŸ‡ª Is this your first time studying in Germany?",
        intro2: "ğŸ“ So youâ€™re coming to WÃ¼rzburg?",
        intro3: "ğŸ“š Feeling lost about where to start?",
        intro4: "âœ¨ WueBuddy",
        intro4sub: "Your friendly chatbot to make exchange life easy and fun.",
        start: "Get Started ğŸš€",
        boards: {
          question: "ğŸ“‹ Q&A Board",
          campus: "ğŸ« Campus Map",
          mensa: "ğŸ¥— Mensa Menu",
          food: "ğŸ½ï¸ Restaurants"
        },
        more: "More",
        back: "â† Back",
        mapBtn: "Open Map ğŸ—ºï¸",
        mensaBtn: "View Mensa Menu ğŸ½ï¸",
        noPosts: "No posts yet.",
        answerTitle: "Answer ğŸ’¬",
        homeBtn: "Back to Home ğŸ”™",
        addMyRestaurant: "Add My Restaurant â•",
        addTitle: "ğŸ½ï¸ Add My Restaurant",
        restNamePh: "Restaurant name",
        restLinkPh: "Google Maps link",
        confirmAdd: "Add âœ¨",
        reviewHeader: "Leave a review",
        reviewPh: "Write a comment",
        reviewSubmit: "Submit",
        avgLabel: "Avg",
        peopleSuffix: ""
      }
    };

    function toggleLang() {
      currentLang = currentLang === 'ko' ? 'en' : 'ko';
      renderLang();
    }

    function renderLang() {
      // Intro
      document.querySelector("#intro1 h1").innerText = LANG[currentLang].intro1;
      document.querySelector("#intro2 h1").innerText = LANG[currentLang].intro2;
      document.querySelector("#intro3 h1").innerText = LANG[currentLang].intro3;
      document.querySelector("#intro4 h1").innerText = LANG[currentLang].intro4;
      document.querySelector("#intro4 p").innerText = LANG[currentLang].intro4sub;
      document.querySelector("#intro4 button").innerText = LANG[currentLang].start;

      // Mensa board button (ì¡´ì¬í•  ë•Œë§Œ)
      const mensaBtn = document.querySelector("#mensa-board .btn");
      if (mensaBtn) mensaBtn.innerText = LANG[currentLang].mensaBtn;

      // Board headingsê°€ ì´ë¯¸ ë Œë”ëœ ë’¤ì— êµì²´
      const qh2 = document.querySelector("#question-board h2");
      const ch2 = document.querySelector("#campus-board h2");
      const mh2 = document.querySelector("#mensa-board h2");
      const fh2 = document.querySelector("#food-board h2");
      if (qh2) qh2.childNodes[0].nodeValue = LANG[currentLang].boards.question + " ";
      if (ch2) ch2.childNodes[0].nodeValue = LANG[currentLang].boards.campus + " ";
      if (mh2) mh2.childNodes[0].nodeValue = LANG[currentLang].boards.mensa + " ";
      if (fh2) fh2.childNodes[0].nodeValue = LANG[currentLang].boards.food + " ";

      // ììœ ê²Œì‹œíŒ placeholder
      const postTitle = document.getElementById("postTitle");
      const postContent = document.getElementById("postContent");
      const postBtn = document.querySelector("#postForm button");
      if (postTitle) postTitle.placeholder = currentLang === 'ko' ? "ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" : "Enter title";
      if (postContent) postContent.placeholder = currentLang === 'ko' ? "ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" : "Enter content";
      if (postBtn) postBtn.innerText = currentLang === 'ko' ? "ë“±ë¡í•˜ê¸° âœ¨" : "Post âœ¨";
    }

    document.getElementById("lang-switch").addEventListener("click", toggleLang);

    /* ========== ê¸°ì¡´ ê¸°ëŠ¥ ìœ ì§€ ========== */
    function showMain() {
      document.querySelectorAll("section").forEach(sec => sec.style.display = "none");
      const main = document.getElementById("mainContent");
      main.style.display = "block";
      loadBoards();
      loadPosts();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    async function loadBoards() {
      await loadQuestionPreview();
      loadCampusPreview();
      loadFoodPreview();
      renderLang(); // ë³´ë“œ ë Œë” í›„ ì–¸ì–´ í…ìŠ¤íŠ¸ ê°±ì‹ 
    }

    async function loadQuestionPreview() {
      const board = document.getElementById("question-board");
      board.innerHTML = "<p>ì§ˆë¬¸ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>";
      try {
        const catRes = await fetch(`${API_BASE}/categories`);
        const catData = await catRes.json();
        const questions = [];
        for (let c of catData.categories) {
          const res = await fetch(`${API_BASE}/questions/${c.id}`);
          const data = await res.json();
          questions.push(...data.questions);
        }
        if (questions.length === 0) throw new Error();
        const preview = shuffleArray(questions).slice(0, 3);
        board.innerHTML = `
          <h2>ğŸ“‹ ì§ˆë¬¸ ê²Œì‹œíŒ <span style="cursor:pointer;color:#0066ff;" onclick="showAllQuestions()">${LANG[currentLang].more}</span></h2>
          <ul>${preview.map(q => `<li onclick="loadAnswer(${q.id})">${q.question}</li>`).join("")}</ul>`;
      } catch {
        board.innerHTML = "<p>âŒ ì§ˆë¬¸ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>";
      }
    }

    function loadCampusPreview() {
      const buildings = [
        { id: 1, name: "Z6 (Hubland Informatik)", address: "Am Hubland, 97074 WÃ¼rzburg", link: "https://www.google.com/maps?q=Z6+Hubland+Informatik+WÃ¼rzburg" },
        { id: 2, name: "Hubland Mensa", address: "Am Hubland, 97074 WÃ¼rzburg", link: "https://www.google.com/maps?q=Hubland+Mensa+WÃ¼rzburg" },
        { id: 3, name: "Zentralbibliothek", address: "Am Hubland, 97074 WÃ¼rzburg", link: "https://www.google.com/maps?q=Zentralbibliothek+UniversitÃ¤t+WÃ¼rzburg" }
      ];
      window._buildings = buildings;
      const preview = shuffleArray(buildings).slice(0, 2);
      const board = document.getElementById("campus-board");
      board.innerHTML = `
        <h2>ğŸ« ìº í¼ìŠ¤ë§µ <span style="cursor:pointer;color:#0066ff;" onclick="showCampusMap()">${LANG[currentLang].more}</span></h2>
        <ul>${preview.map(b => `<li onclick="showBuilding(${b.id})">${b.name}</li>`).join("")}</ul>
        <button class="btn" style="margin-top:10px;" onclick="openMapView()">${LANG[currentLang].mapBtn}</button>`;
    }

    function shuffleArray(arr) { return arr.sort(() => Math.random() - 0.5); }

    async function loadAnswer(qId) {
      const res = await fetch(`${API_BASE}/answer/${qId}`);
      const data = await res.json();
      const box = document.getElementById("answer-box");
      box.style.display = "block";
      box.innerHTML = `<h3>${LANG[currentLang].answerTitle}</h3><p>${data.answer}</p><button class="btn" onclick="backToHome()">${LANG[currentLang].homeBtn}</button>`;
    }

    /* âœï¸ ììœ ê²Œì‹œíŒ (ê¸°ì¡´ ìœ ì§€) */
    async function loadPosts() {
      const res = await fetch(`${API_BASE}/posts`);
      const data = await res.json();
      const postList = document.getElementById("postList");
      if (data.posts.length === 0) {
        postList.innerHTML = `<p>${LANG[currentLang].noPosts}</p>`;
        return;
      }
      postList.innerHTML = data.posts.map(p => `
        <div style="border-bottom:1px solid #eee;padding:10px 0;">
          <strong>ìµëª…</strong> Â· <span style="color:#888;">${p.created_at}</span><br>
          <b>${p.title}</b><br>
          <p style="margin-top:5px;">${p.content}</p>
        </div>`).join("");
    }

    async function createPost(e) {
      e.preventDefault();
      const title = document.getElementById("postTitle").value.trim();
      const content = document.getElementById("postContent").value.trim();
      if (!title || !content) return alert(currentLang === 'ko' ? "ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!" : "Please enter both title and content!");
      const formData = new FormData();
      formData.append("title", title);
      formData.append("content", content);
      const res = await fetch(`${API_BASE}/posts/new`, { method: "POST", body: formData });
      const data = await res.json();
      alert(data.message);
      document.getElementById("postForm").reset();
      loadPosts();
    }

    /* ğŸ½ï¸ ë§›ì§‘ ê¸°ëŠ¥ í™•ì¥ */
    function loadFoodPreview() {
      fetch(`${API_BASE}/restaurants`)
        .then(res => res.json())
        .then(data => {
          const f = data.restaurants || [];
          const preview = f.slice(0, 2);
          const board = document.getElementById("food-board");
          board.innerHTML = `
            <h2>ğŸ½ï¸ ${LANG[currentLang].boards.food} <span style="cursor:pointer;color:#0066ff;" onclick="showFoodList()">${LANG[currentLang].more}</span></h2>
            <ul>${preview.map(x => `
              <li onclick="showFood(${x.id})">
                ${x.name} <span style="color:#ffa500;">â­ ${Number(x.avg).toFixed(1)}</span>
              </li>`).join("")}</ul>`;
        });
    }

    function showFoodList() {
      fetch(`${API_BASE}/restaurants`)
        .then(res => res.json())
        .then(data => {
          const f = data.restaurants || [];
          const board = document.getElementById("food-board");
          board.innerHTML = `
            <h2>ğŸ½ï¸ ${LANG[currentLang].boards.food}
              <span style="cursor:pointer;color:#0066ff;" onclick="loadBoards()">${LANG[currentLang].back}</span>
              <button class="btn" style="margin-left:10px;background:#28a745" onclick="openAddRestaurant()">${LANG[currentLang].addMyRestaurant}</button>
            </h2>
            <ul>${f.map(x => `
              <li onclick="showFood(${x.id})">
                ${x.name} 
                <span style="color:#ffa500;">â­ ${Number(x.avg).toFixed(1)}</span>
                <span style="color:#777;">(${x.count})</span>
              </li>`).join("")}</ul>`;
        });
    }

    function openAddRestaurant() {
      const box = document.getElementById("answer-box");
      box.style.display = "block";
      box.innerHTML = `
        <h3>${LANG[currentLang].addTitle}</h3>
        <form id="addRestForm" onsubmit="createRestaurant(event)">
          <input type="text" id="restName" placeholder="${LANG[currentLang].restNamePh}" required style="width:70%;padding:8px;"><br>
          <input type="text" id="restLink" placeholder="${LANG[currentLang].restLinkPh}" required style="width:70%;padding:8px;margin-top:5px;"><br>
          <button type="submit" class="btn" style="margin-top:10px;">${LANG[currentLang].confirmAdd}</button>
        </form>
        <button class="btn" style="margin-top:10px;background:#777;" onclick="backToHome()">${LANG[currentLang].back}</button>
      `;
    }

    function createRestaurant(e) {
      e.preventDefault();
      const formData = new FormData();
      formData.append("name", document.getElementById("restName").value.trim());
      formData.append("link", document.getElementById("restLink").value.trim());
      fetch(`${API_BASE}/restaurants/new`, { method: "POST", body: formData })
        .then(res => res.json())
        .then(data => {
          alert(data.message);
          backToHome();
        });
    }

    function showFood(id) {
      fetch(`${API_BASE}/restaurants`)
        .then(res => res.json())
        .then(data => {
          const f = (data.restaurants || []).find(x => x.id === id);
          if (!f) return;
          const box = document.getElementById("answer-box");
          box.style.display = "block";
          box.innerHTML = `
            <h3>${f.name}</h3>
            <p><a class="map-link" href="${f.link}" target="_blank">Google Maps</a></p>
            <p>â­ ${LANG[currentLang].avgLabel} ${Number(f.avg).toFixed(1)} (${f.count}${LANG[currentLang].peopleSuffix})</p>

            <h4>${LANG[currentLang].reviewHeader}</h4>
            <form id="reviewForm" onsubmit="createReview(event, ${f.id})">
              <select id="rating" required>
                <option value="">${currentLang === 'ko' ? 'ë³„ì  ì„ íƒ' : 'Select rating'}</option>
                ${[1,2,3,4,5].map(x => `<option value="${x}">${'â­'.repeat(x)}</option>`).join("")}
              </select><br>
              <textarea id="comment" placeholder="${LANG[currentLang].reviewPh}" required
                style="width:80%;height:60px;margin-top:6px;padding:8px;"></textarea><br>
              <button type="submit" class="btn">${LANG[currentLang].reviewSubmit}</button>
            </form>

            <div id="reviewList" style="margin-top:15px;"></div>
            <button class="btn" onclick="backToHome()">${LANG[currentLang].homeBtn}</button>
          `;
          loadReviews(id);
        });
    }

    function createReview(e, id) {
      e.preventDefault();
      const formData = new FormData();
      formData.append("restaurant_id", id);
      formData.append("rating", document.getElementById("rating").value);
      formData.append("comment", document.getElementById("comment").value);
      fetch(`${API_BASE}/reviews/new`, { method: "POST", body: formData })
        .then(res => res.json())
        .then(data => {
          alert(data.message);
          loadReviews(id);
          document.getElementById("reviewForm").reset();
        });
    }

    function loadReviews(id) {
      fetch(`${API_BASE}/reviews/${id}`)
        .then(res => res.json())
        .then(data => {
          const container = document.getElementById("reviewList");
          const list = data.reviews || [];
          if (!list.length) {
            container.innerHTML = `<p>${currentLang === 'ko' ? 'ì•„ì§ í›„ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.' : 'No reviews yet.'}</p>`;
            return;
          }
          container.innerHTML = list.map(r => `
            <div style="border-bottom:1px solid #ddd;padding:6px 0;">
              <b>${'â­'.repeat(r.rating)}</b> - ${r.comment}
              <div style="font-size:0.9em;color:#888;">${r.created_at}</div>
            </div>
          `).join("");
        });
    }

    /* ====== ê¸°ì¡´ ë³´ì¡° í•¨ìˆ˜ (ëˆ„ë½ ë°©ì§€) ====== */
    function backToHome() {
      document.getElementById("answer-box").style.display = "none";
      loadBoards();
      loadPosts();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showCampusMap() {
      const b = window._buildings;
      const board = document.getElementById("campus-board");
      board.innerHTML = `
        <h2>ğŸ« ${LANG[currentLang].boards.campus} <span style="cursor:pointer;color:#0066ff;" onclick="loadBoards()">${LANG[currentLang].back}</span></h2>
        <ul>${b.map(x => `<li onclick="showBuilding(${x.id})">${x.name}</li>`).join("")}</ul>
      `;
    }

    function showBuilding(id) {
      const b = window._buildings.find(x => x.id === id);
      const box = document.getElementById("answer-box");
      box.style.display = "block";
      box.innerHTML = `
        <h3>${b.name}</h3>
        <p>ğŸ“ ${b.address}</p>
        <p><a class="map-link" href="${b.link}" target="_blank">Google Maps</a></p>
        <button class="btn" onclick="backToHome()">${LANG[currentLang].homeBtn}</button>
      `;
    }

    function openMapView() {
      document.getElementById("campus-board").style.display = "none";
      const mapView = document.createElement("div");
      mapView.id = "campus-map-view";
      mapView.innerHTML = `
        <h2>ğŸ« ${LANG[currentLang].boards.campus}</h2>
        <iframe 
          src="https://www.google.com/maps/d/u/0/embed?mid=1xLYXxhEnRby6e9MDMGtbcvEJCEIAxXU&ehbc=2E312F"
          width="90%" height="600"
          style="border-radius:12px; border:0; margin-top:10px;">
        </iframe>
        <button class="btn" style="margin-top:15px;" onclick="closeMapView()">${LANG[currentLang].back}</button>
      `;
      document.getElementById("mainContent").appendChild(mapView);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function closeMapView() {
      const mapView = document.getElementById("campus-map-view");
      if (mapView) mapView.remove();
      document.getElementById("campus-board").style.display = "block";
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function openMensa() {
      window.open("https://www.swerk-wue.de/wuerzburg/essen-trinken/mensen-speiseplaene/mensa-campus-hubland-sued/menu", "_blank");
    }

    async function showAllQuestions() {
      const res = await fetch(`${API_BASE}/categories`);
      const data = await res.json();
      const board = document.getElementById("question-board");
      board.innerHTML = `
        <h2>ğŸ“‹ ${LANG[currentLang].boards.question} <span style="cursor:pointer;color:#0066ff;" onclick="loadBoards()">${LANG[currentLang].back}</span></h2>
        <ul>${data.categories.map(c => `<li onclick="loadQuestions(${c.id})">${c.name}</li>`).join("")}</ul>
      `;
    }

    async function loadQuestions(catId) {
      const res = await fetch(`${API_BASE}/questions/${catId}`);
      const data = await res.json();
      const board = document.getElementById("question-board");
      board.innerHTML = `
        <h2>ğŸ“‹ ${LANG[currentLang].boards.question} <span style="cursor:pointer;color:#0066ff;" onclick="showAllQuestions()">${LANG[currentLang].back}</span></h2>
        <ul>${data.questions.map(q => `<li onclick="loadAnswer(${q.id})">${q.question}</li>`).join("")}</ul>
      `;
    }
  </script>
</body>
</html>
