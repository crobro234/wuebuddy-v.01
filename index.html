<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>WueBuddy | 뷔르츠부르크 교환학생 도우미</title>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{font-family:"Noto Sans KR",sans-serif;overflow-x:hidden;scroll-behavior:smooth;background:#f7f8fa}

    /* Intro */
    section.intro {
      height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center;
      color:#fff; text-align:center; background-size:cover; background-position:center; position:relative;
    }
    section.intro::before{content:""; position:absolute; inset:0; background:rgba(0,0,0,.4)}
    section.intro>*{position:relative; z-index:1}
    h1{font-size:2.8em; margin-bottom:.4em; text-shadow:0 2px 8px rgba(0,0,0,.5)}
    p.lead{font-size:1.2em; max-width:800px; line-height:1.6}

    .btn{
      margin-top:36px; background:#0066ff; color:#fff; border:none; padding:14px 24px;
      font-size:1.05em; border-radius:10px; cursor:pointer; transition:.2s
    }
    .btn:hover{background:#004bcc}

    #intro1{background-image:url('https://images.unsplash.com/photo-1559305616-3f99c7779865?auto=format&fit=crop&w=1600&q=80')}
    #intro2{background-image:url('https://images.unsplash.com/photo-1528909514045-2fa4ac7a08ba?auto=format&fit=crop&w=1600&q=80')}
    #intro3{background-image:url('https://images.unsplash.com/photo-1532948488455-68dabc39f023?auto=format&fit=crop&w=1600&q=80')}
    #intro4{background-image:url('https://images.unsplash.com/photo-1505761671935-60b3a7427bad?auto=format&fit=crop&w=1600&q=80')}

    /* App pages */
    .section-page{display:none; min-height:100vh; padding:40px 18px}
    .container{max-width:980px; margin:0 auto}

    .heading{font-size:1.8em; color:#222; margin-bottom:18px; font-weight:700}
    .board{
      background:#fff; border-radius:12px; padding:18px; margin-bottom:20px;
      box-shadow:0 4px 14px rgba(0,0,0,.08)
    }
    .board h2{
      display:flex; justify-content:space-between; align-items:center; font-size:1.25em;
      color:#004bcc; padding-bottom:8px; border-bottom:2px solid #eef1f6; margin-bottom:8px
    }
    .more{cursor:pointer; color:#0066ff; font-size:.95em}
    ul.list{list-style:none}
    ul.list li.item{
      padding:12px 8px; border-bottom:1px solid #f0f2f7; cursor:pointer; transition:.15s;
    }
    ul.list li.item:hover{background:#f3f6ff}
    .muted{color:#666; font-size:.95em}

    /* Accordion detail under item */
    .detail{
      margin-top:10px; background:#fbfcff; border:1px solid #e7ecf7; border-radius:10px; padding:14px;
      animation:fadeIn .18s ease; font-size:.98em; color:#333
    }
    .detail p{margin:6px 0}
    .backbar{display:flex; gap:10px; align-items:center; margin-bottom:14px}
    .backlink{cursor:pointer; color:#0066ff}
    .spacer{height:8px}

    a.map-link{color:#004bcc; font-weight:700; text-decoration:none}
    a.map-link:hover{text-decoration:underline}

    @keyframes fadeIn {from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:translateY(0)}}
  </style>
</head>
<body>

  <!-- Intro 1~4 -->
  <section id="intro1" class="intro">
    <h1 data-aos="fade-up">🇩🇪 독일 교환학생이 처음이신가요?</h1>
  </section>
  <section id="intro2" class="intro">
    <h1 data-aos="fade-right">🎓 뷔르츠부르크로 오신다고요?</h1>
    <p class="lead" data-aos="fade-left" data-aos-delay="200">새로운 나라, 새로운 대학... 준비할 게 너무 많죠.</p>
  </section>
  <section id="intro3" class="intro">
    <h1 data-aos="fade-left">📚 어디서부터 알아봐야 할지 막막하다면,</h1>
    <p class="lead" data-aos="fade-right" data-aos-delay="200">뷔르츠부르크 경험자가 직접 만든 가이드가 도와드릴게요.</p>
  </section>
  <section id="intro4" class="intro">
    <h1 data-aos="zoom-in">✨ WueBuddy</h1>
    <p class="lead" data-aos="fade-up" data-aos-delay="200">교환학생 생활을 쉽고 즐겁게 만들어줄 도우미.</p>
    <button class="btn" data-aos="fade-up" data-aos-delay="400" onclick="goHome()">시작하기 🚀</button>
  </section>

  <!-- 메인 보드(미리보기) -->
  <div id="page-home" class="section-page">
    <div class="container">
      <div class="heading">📚 WueBuddy 게시판</div>

      <div id="board-questions" class="board" data-aos="fade-up">
        <h2>📋 질문 게시판 <span class="more" onclick="showQuestionPage()">더 보기</span></h2>
        <ul id="preview-questions" class="list"></ul>
      </div>

      <div id="board-campus" class="board" data-aos="fade-up">
        <h2>🏫 캠퍼스맵 <span class="more" onclick="showCampusPage()">더 보기</span></h2>
        <ul id="preview-campus" class="list"></ul>
      </div>

      <div id="board-food" class="board" data-aos="fade-up">
        <h2>🍽️ 맛집 추천 <span class="more" onclick="showFoodPage()">더 보기</span></h2>
        <ul id="preview-food" class="list"></ul>
      </div>
    </div>
  </div>

  <!-- 질문 전용 페이지 -->
  <div id="page-questions" class="section-page">
    <div class="container">
      <div class="backbar">
        <span class="backlink" onclick="goHome()">← 홈으로</span>
        <span class="muted">질문 게시판</span>
      </div>

      <div id="q-cats" class="board">
        <h2>카테고리</h2>
        <ul id="q-cat-list" class="list"></ul>
      </div>

      <div id="q-list-wrap" class="board" style="display:none;">
        <h2 id="q-current-cat">질문 목록</h2>
        <ul id="q-list" class="list"></ul>
      </div>
    </div>
  </div>

  <!-- 캠퍼스 전용 페이지 -->
  <div id="page-campus" class="section-page">
    <div class="container">
      <div class="backbar">
        <span class="backlink" onclick="goHome()">← 홈으로</span>
        <span class="muted">캠퍼스맵</span>
      </div>

      <div class="board">
        <h2>건물 목록</h2>
        <ul id="campus-list" class="list"></ul>
      </div>
    </div>
  </div>

  <!-- 맛집 전용 페이지 -->
  <div id="page-food" class="section-page">
    <div class="container">
      <div class="backbar">
        <span class="backlink" onclick="goHome()">← 홈으로</span>
        <span class="muted">맛집 추천</span>
      </div>

      <div class="board">
        <h2>식당 목록</h2>
        <ul id="food-list" class="list"></ul>
      </div>
    </div>
  </div>

  <!-- JS -->
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
    AOS.init({duration:1000, once:true});
    const API_BASE = window.location.origin;

    // 로컬 데이터: 캠퍼스, 맛집
    const BUILDINGS = [
      { id:1, name:"Z6 (Hubland Informatik)", address:"Am Hubland, 97074 Würzburg", link:"https://www.google.com/maps?q=Z6+Hubland+Informatik+Würzburg" },
      { id:2, name:"Hubland Mensa",           address:"Am Hubland, 97074 Würzburg", link:"https://www.google.com/maps?q=Hubland+Mensa+Würzburg" },
      { id:3, name:"Zentralbibliothek",        address:"Am Hubland, 97074 Würzburg", link:"https://www.google.com/maps?q=Zentralbibliothek+Universität+Würzburg" },
      { id:4, name:"Sprachenzentrum",          address:"Am Hubland Nord 12, 97074 Würzburg", link:"https://www.google.com/maps?q=Sprachenzentrum+Universität+Würzburg" },
    ];
    const FOODS = [
      { id:1, name:"Berlin Döner",         address:"Domstraße 3, 97070 Würzburg", link:"https://www.google.com/maps?q=Berlin+Döner+Domstraße+3+97070+Würzburg" },
      { id:2, name:"L'Osteria Würzburg",   address:"Röntgenring 3, 97070 Würzburg", link:"https://www.google.com/maps?q=L'Osteria+Würzburg+Röntgenring+3+97070+Würzburg" },
    ];

    // 라우팅 유틸
    function hideAllPages(){
      document.querySelectorAll('.section-page').forEach(p=>p.style.display='none');
    }
    function showPage(id){
      hideAllPages();
      document.getElementById(id).style.display='block';
      window.scrollTo({top:0, behavior:'smooth'});
      AOS.refresh();
    }

    // 홈으로
    function goHome(){
      // 인트로 감추고 홈만
      document.querySelectorAll('section.intro').forEach(s=>s.style.display='none');
      showPage('page-home');
      loadHomePreviews();
    }

    // 초기 진입 시 홈 렌더링
    // (사용자가 버튼 누르면 호출되도록 구성함)

    /* =========================
       홈: 미리보기(랜덤) 로딩
       ========================= */
    async function loadHomePreviews(){
      await loadQuestionPreview();   // 질문 3개 랜덤
      loadCampusPreview();           // 캠퍼스 2개 랜덤
      loadFoodPreview();             // 맛집 2개 랜덤
    }

    // 배열 셔플
    function shuffle(arr){ return [...arr].sort(()=>Math.random()-0.5); }

    // 질문 미리보기: /categories -> /questions/{id}들 모아 랜덤3
    async function loadQuestionPreview(){
      const ul = document.getElementById('preview-questions');
      ul.innerHTML = `<li class="item muted">불러오는 중...</li>`;
      try{
        const catRes = await fetch(`${API_BASE}/categories`);
        const cats = (await catRes.json()).categories || [];
        const allQ = [];
        for(const c of cats){
          const qRes = await fetch(`${API_BASE}/questions/${c.id}`);
          const qs = (await qRes.json()).questions || [];
          // catId를 붙여서 보관 (미리보기에서 클릭 시 바로 전용 페이지에서 열기 위해)
          qs.forEach(q => allQ.push({ ...q, catId: c.id, catName: c.name }));
        }

        if(allQ.length===0){ ul.innerHTML = `<li class="item muted">등록된 질문이 없습니다.</li>`; return; }

        const pick = shuffle(allQ).slice(0,3);
        ul.innerHTML = pick.map(q =>
          `<li class="item" onclick="showQuestionPage(${q.catId}, ${q.id})">${q.question}</li>`
        ).join('');
      }catch(e){
        console.error(e);
        ul.innerHTML = `<li class="item muted">❌ 질문을 불러올 수 없습니다.</li>`;
      }
    }

    // 캠퍼스 미리보기 (2개)
    function loadCampusPreview(){
      const ul = document.getElementById('preview-campus');
      const pick = shuffle(BUILDINGS).slice(0,2);
      ul.innerHTML = pick.map(b=>`<li class="item" onclick="showCampusPage(${b.id})">${b.name}</li>`).join('');
    }

    // 맛집 미리보기 (2개)
    function loadFoodPreview(){
      const ul = document.getElementById('preview-food');
      const pick = shuffle(FOODS).slice(0,2);
      ul.innerHTML = pick.map(f=>`<li class="item" onclick="showFoodPage(${f.id})">${f.name}</li>`).join('');
    }

    /* =========================
       질문 전용 페이지
       ========================= */
    async function showQuestionPage(openCatId=null, openQId=null){
      showPage('page-questions');

      // 카테고리 렌더
      const catUl = document.getElementById('q-cat-list');
      catUl.innerHTML = `<li class="item muted">카테고리 불러오는 중...</li>`;
      const res = await fetch(`${API_BASE}/categories`);
      const cats = (await res.json()).categories || [];
      catUl.innerHTML = cats.map(c => `<li class="item" onclick="loadQuestionList(${c.id})">${c.name}</li>`).join('');

      // 특정 카테고리/질문을 바로 열어달라고 요청된 경우
      if(openCatId){
        await loadQuestionList(openCatId, openQId);
      }else{
        // 기본: 첫 번째 카테고리 로딩(선택은 사용자가)
        document.getElementById('q-list-wrap').style.display='none';
      }
    }

    async function loadQuestionList(catId, openQId=null){
      const wrap = document.getElementById('q-list-wrap');
      const title = document.getElementById('q-current-cat');
      const ul = document.getElementById('q-list');

      // 카테고리명 표시
      try{
        const catRes = await fetch(`${API_BASE}/categories`);
        const cats = (await catRes.json()).categories || [];
        const cat = cats.find(c=>c.id===catId);
        title.textContent = cat ? `질문 목록 — ${cat.name}` : '질문 목록';
      }catch{ title.textContent = '질문 목록'; }

      wrap.style.display='block';
      ul.innerHTML = `<li class="item muted">질문 불러오는 중...</li>`;

      const qRes = await fetch(`${API_BASE}/questions/${catId}`);
      const qs = (await qRes.json()).questions || [];
      if(qs.length===0){
        ul.innerHTML = `<li class="item muted">아직 등록된 질문이 없습니다.</li>`; return;
      }

      ul.innerHTML = qs.map(q => `
        <li class="item" data-qid="${q.id}" onclick="toggleAnswer(event, ${q.id})">
          ${q.question}
        </li>
      `).join('');

      // 특정 질문을 바로 펼치기
      if(openQId){
        const li = ul.querySelector(`li[data-qid="${openQId}"]`);
        if(li) toggleAnswer({currentTarget:li}, openQId, true);
      }
    }

    async function toggleAnswer(ev, qId, skipScroll=false){
      const li = ev.currentTarget || ev; // programmatic call 지원
      // 이미 열려있으면 닫기
      const opened = li.querySelector('.detail');
      if(opened){ opened.remove(); return; }

      // 다른 항목들 detail 닫기
      li.parentElement.querySelectorAll('.detail').forEach(x=>x.remove());

      // 데이터 가져오기
      const res = await fetch(`${API_BASE}/answer/${qId}`);
      const data = await res.json();

      const div = document.createElement('div');
      div.className = 'detail';
      div.innerHTML = `
        <p>${data.answer}</p>
        <div class="spacer"></div>
        <button class="btn" onclick="closeDetail(this)">닫기</button>
      `;
      li.appendChild(div);

      if(!skipScroll){
        li.scrollIntoView({behavior:'smooth', block:'center'});
      }
    }
    function closeDetail(btn){
      btn.closest('.detail').remove();
    }

    /* =========================
       캠퍼스 전용 페이지
       ========================= */
    function showCampusPage(openId=null){
      showPage('page-campus');
      const ul = document.getElementById('campus-list');
      ul.innerHTML = BUILDINGS.map(b=>`
        <li class="item" data-bid="${b.id}" onclick="toggleBuilding(event, ${b.id})">${b.name}</li>
      `).join('');
      if(openId){
        const li = ul.querySelector(`li[data-bid="${openId}"]`);
        if(li) toggleBuilding({currentTarget:li}, openId, true);
      }
    }
    function toggleBuilding(ev, id, skipScroll=false){
      const li = ev.currentTarget || ev;
      const b = BUILDINGS.find(x=>x.id===id);
      const opened = li.querySelector('.detail');
      if(opened){ opened.remove(); return; }
      li.parentElement.querySelectorAll('.detail').forEach(x=>x.remove());
      const div = document.createElement('div');
      div.className = 'detail';
      div.innerHTML = `
        <p><strong>${b.name}</strong></p>
        <p>📍 ${b.address}</p>
        <p><a class="map-link" href="${b.link}" target="_blank">Google Maps로 보기 🔗</a></p>
        <div class="spacer"></div>
        <button class="btn" onclick="closeDetail(this)">닫기</button>
      `;
      li.appendChild(div);
      if(!skipScroll){ li.scrollIntoView({behavior:'smooth', block:'center'}); }
    }

    /* =========================
       맛집 전용 페이지
       ========================= */
    function showFoodPage(openId=null){
      showPage('page-food');
      const ul = document.getElementById('food-list');
      ul.innerHTML = FOODS.map(f=>`
        <li class="item" data-fid="${f.id}" onclick="toggleFood(event, ${f.id})">${f.name}</li>
      `).join('');
      if(openId){
        const li = ul.querySelector(`li[data-fid="${openId}"]`);
        if(li) toggleFood({currentTarget:li}, openId, true);
      }
    }
    function toggleFood(ev, id, skipScroll=false){
      const li = ev.currentTarget || ev;
      const f = FOODS.find(x=>x.id===id);
      const opened = li.querySelector('.detail');
      if(opened){ opened.remove(); return; }
      li.parentElement.querySelectorAll('.detail').forEach(x=>x.remove());
      const div = document.createElement('div');
      div.className = 'detail';
      div.innerHTML = `
        <p><strong>${f.name}</strong></p>
        <p>📍 ${f.address}</p>
        <p><a class="map-link" href="${f.link}" target="_blank">Google Maps로 보기 🔗</a></p>
        <div class="spacer"></div>
        <button class="btn" onclick="closeDetail(this)">닫기</button>
      `;
      li.appendChild(div);
      if(!skipScroll){ li.scrollIntoView({behavior:'smooth', block:'center'}); }
    }
  </script>
</body>
</html>
