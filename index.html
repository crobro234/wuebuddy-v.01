<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>WueBuddy | ë·”ë¥´ì¸ ë¶€ë¥´í¬ êµí™˜í•™ìƒ ë„ìš°ë¯¸</title>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{font-family:"Noto Sans KR",sans-serif;overflow-x:hidden;scroll-behavior:smooth;background:#f7f8fa}

    /* Intro */
    section.intro {
      height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center;
      color:#fff; text-align:center; background-size:cover; background-position:center; position:relative;
    }
    section.intro::before{content:""; position:absolute; inset:0; background:rgba(0,0,0,.4)}
    section.intro>*{position:relative; z-index:1}
    h1{font-size:2.8em; margin-bottom:.4em; text-shadow:0 2px 8px rgba(0,0,0,.5)}
    p.lead{font-size:1.2em; max-width:800px; line-height:1.6}

    .btn{
      margin-top:36px; background:#0066ff; color:#fff; border:none; padding:14px 24px;
      font-size:1.05em; border-radius:10px; cursor:pointer; transition:.2s
    }
    .btn:hover{background:#004bcc}

    #intro1{background-image:url('https://images.unsplash.com/photo-1559305616-3f99c7779865?auto=format&fit=crop&w=1600&q=80')}
    #intro2{background-image:url('https://images.unsplash.com/photo-1528909514045-2fa4ac7a08ba?auto=format&fit=crop&w=1600&q=80')}
    #intro3{background-image:url('https://images.unsplash.com/photo-1532948488455-68dabc39f023?auto=format&fit=crop&w=1600&q=80')}
    #intro4{background-image:url('https://images.unsplash.com/photo-1505761671935-60b3a7427bad?auto=format&fit=crop&w=1600&q=80')}

    /* App pages */
    .section-page{display:none; min-height:100vh; padding:40px 18px}
    .container{max-width:980px; margin:0 auto}

    .heading{font-size:1.8em; color:#222; margin-bottom:18px; font-weight:700}
    .board{
      background:#fff; border-radius:12px; padding:18px; margin-bottom:20px;
      box-shadow:0 4px 14px rgba(0,0,0,.08)
    }
    .board h2{
      display:flex; justify-content:space-between; align-items:center; font-size:1.25em;
      color:#004bcc; padding-bottom:8px; border-bottom:2px solid #eef1f6; margin-bottom:8px
    }
    .more{cursor:pointer; color:#0066ff; font-size:.95em}
    ul.list{list-style:none}
    ul.list li.item{
      padding:12px 8px; border-bottom:1px solid #f0f2f7; cursor:pointer; transition:.15s;
    }
    ul.list li.item:hover{background:#f3f6ff}
    .muted{color:#666; font-size:.95em}

    /* Accordion detail under item */
    .detail{
      margin-top:10px; background:#fbfcff; border:1px solid #e7ecf7; border-radius:10px; padding:14px;
      animation:fadeIn .18s ease; font-size:.98em; color:#333
    }
    .detail p{margin:6px 0}
    .backbar{display:flex; gap:10px; align-items:center; margin-bottom:14px}
    .backlink{cursor:pointer; color:#0066ff}
    .spacer{height:8px}

    a.map-link{color:#004bcc; font-weight:700; text-decoration:none}
    a.map-link:hover{text-decoration:underline}

    @keyframes fadeIn {from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:translateY(0)}}
  </style>
</head>
<body>

  <!-- Intro 1~4 -->
  <section id="intro1" class="intro">
    <h1 data-aos="fade-up">ğŸ‡©ğŸ‡ª ë…ì¼ êµí™˜í•™ìƒì´ ì²˜ìŒì´ì‹ ê°€ìš”?</h1>
  </section>
  <section id="intro2" class="intro">
    <h1 data-aos="fade-right">ğŸ“ ë·”ë¥´ì¸ ë¶€ë¥´í¬ë¡œ ì˜¤ì‹ ë‹¤ê³ ìš”?</h1>
    <p class="lead" data-aos="fade-left" data-aos-delay="200">ìƒˆë¡œìš´ ë‚˜ë¼, ìƒˆë¡œìš´ ëŒ€í•™... ì¤€ë¹„í•  ê²Œ ë„ˆë¬´ ë§ì£ .</p>
  </section>
  <section id="intro3" class="intro">
    <h1 data-aos="fade-left">ğŸ“š ì–´ë””ì„œë¶€í„° ì•Œì•„ë´ì•¼ í• ì§€ ë§‰ë§‰í•˜ë‹¤ë©´,</h1>
    <p class="lead" data-aos="fade-right" data-aos-delay="200">ë·”ë¥´ì¸ ë¶€ë¥´í¬ ê²½í—˜ìê°€ ì§ì ‘ ë§Œë“  ê°€ì´ë“œê°€ ë„ì™€ë“œë¦´ê²Œìš”.</p>
  </section>
  <section id="intro4" class="intro">
    <h1 data-aos="zoom-in">âœ¨ WueBuddy</h1>
    <p class="lead" data-aos="fade-up" data-aos-delay="200">êµí™˜í•™ìƒ ìƒí™œì„ ì‰½ê³  ì¦ê²ê²Œ ë§Œë“¤ì–´ì¤„ ë„ìš°ë¯¸.</p>
    <button class="btn" data-aos="fade-up" data-aos-delay="400" onclick="goHome()">ì‹œì‘í•˜ê¸° ğŸš€</button>
  </section>

  <!-- ë©”ì¸ ë³´ë“œ(ë¯¸ë¦¬ë³´ê¸°) -->
  <div id="page-home" class="section-page">
    <div class="container">
      <div class="heading">ğŸ“š WueBuddy ê²Œì‹œíŒ</div>

      <div id="board-questions" class="board" data-aos="fade-up">
        <h2>ğŸ“‹ ì§ˆë¬¸ ê²Œì‹œíŒ <span class="more" onclick="showQuestionPage()">ë” ë³´ê¸°</span></h2>
        <ul id="preview-questions" class="list"></ul>
      </div>

      <div id="board-campus" class="board" data-aos="fade-up">
        <h2>ğŸ« ìº í¼ìŠ¤ë§µ <span class="more" onclick="showCampusPage()">ë” ë³´ê¸°</span></h2>
        <ul id="preview-campus" class="list"></ul>
      </div>

      <div id="board-food" class="board" data-aos="fade-up">
        <h2>ğŸ½ï¸ ë§›ì§‘ ì¶”ì²œ <span class="more" onclick="showFoodPage()">ë” ë³´ê¸°</span></h2>
        <ul id="preview-food" class="list"></ul>
      </div>
    </div>
  </div>

  <!-- ì§ˆë¬¸ ì „ìš© í˜ì´ì§€ -->
  <div id="page-questions" class="section-page">
    <div class="container">
      <div class="backbar">
        <span class="backlink" onclick="goHome()">â† í™ˆìœ¼ë¡œ</span>
        <span class="muted">ì§ˆë¬¸ ê²Œì‹œíŒ</span>
      </div>

      <div id="q-cats" class="board">
        <h2>ì¹´í…Œê³ ë¦¬</h2>
        <ul id="q-cat-list" class="list"></ul>
      </div>

      <div id="q-list-wrap" class="board" style="display:none;">
        <h2 id="q-current-cat">ì§ˆë¬¸ ëª©ë¡</h2>
        <ul id="q-list" class="list"></ul>
      </div>
    </div>
  </div>

  <!-- ìº í¼ìŠ¤ ì „ìš© í˜ì´ì§€ -->
  <div id="page-campus" class="section-page">
    <div class="container">
      <div class="backbar">
        <span class="backlink" onclick="goHome()">â† í™ˆìœ¼ë¡œ</span>
        <span class="muted">ìº í¼ìŠ¤ë§µ</span>
      </div>

      <div class="board">
        <h2>ê±´ë¬¼ ëª©ë¡</h2>
        <ul id="campus-list" class="list"></ul>
      </div>
    </div>
  </div>

  <!-- ë§›ì§‘ ì „ìš© í˜ì´ì§€ -->
  <div id="page-food" class="section-page">
    <div class="container">
      <div class="backbar">
        <span class="backlink" onclick="goHome()">â† í™ˆìœ¼ë¡œ</span>
        <span class="muted">ë§›ì§‘ ì¶”ì²œ</span>
      </div>

      <div class="board">
        <h2>ì‹ë‹¹ ëª©ë¡</h2>
        <ul id="food-list" class="list"></ul>
      </div>
    </div>
  </div>

  <!-- JS -->
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script>
    AOS.init({duration:1000, once:true});
    const API_BASE = window.location.origin;

    // ë¡œì»¬ ë°ì´í„°: ìº í¼ìŠ¤, ë§›ì§‘
    const BUILDINGS = [
      { id:1, name:"Z6 (Hubland Informatik)", address:"Am Hubland, 97074 WÃ¼rzburg", link:"https://www.google.com/maps?q=Z6+Hubland+Informatik+WÃ¼rzburg" },
      { id:2, name:"Hubland Mensa",           address:"Am Hubland, 97074 WÃ¼rzburg", link:"https://www.google.com/maps?q=Hubland+Mensa+WÃ¼rzburg" },
      { id:3, name:"Zentralbibliothek",        address:"Am Hubland, 97074 WÃ¼rzburg", link:"https://www.google.com/maps?q=Zentralbibliothek+UniversitÃ¤t+WÃ¼rzburg" },
      { id:4, name:"Sprachenzentrum",          address:"Am Hubland Nord 12, 97074 WÃ¼rzburg", link:"https://www.google.com/maps?q=Sprachenzentrum+UniversitÃ¤t+WÃ¼rzburg" },
    ];
    const FOODS = [
      { id:1, name:"Berlin DÃ¶ner",         address:"DomstraÃŸe 3, 97070 WÃ¼rzburg", link:"https://www.google.com/maps?q=Berlin+DÃ¶ner+DomstraÃŸe+3+97070+WÃ¼rzburg" },
      { id:2, name:"L'Osteria WÃ¼rzburg",   address:"RÃ¶ntgenring 3, 97070 WÃ¼rzburg", link:"https://www.google.com/maps?q=L'Osteria+WÃ¼rzburg+RÃ¶ntgenring+3+97070+WÃ¼rzburg" },
    ];

    // ë¼ìš°íŒ… ìœ í‹¸
    function hideAllPages(){
      document.querySelectorAll('.section-page').forEach(p=>p.style.display='none');
    }
    function showPage(id){
      hideAllPages();
      document.getElementById(id).style.display='block';
      window.scrollTo({top:0, behavior:'smooth'});
      AOS.refresh();
    }

    // í™ˆìœ¼ë¡œ
    function goHome(){
      // ì¸íŠ¸ë¡œ ê°ì¶”ê³  í™ˆë§Œ
      document.querySelectorAll('section.intro').forEach(s=>s.style.display='none');
      showPage('page-home');
      loadHomePreviews();
    }

    // ì´ˆê¸° ì§„ì… ì‹œ í™ˆ ë Œë”ë§
    // (ì‚¬ìš©ìê°€ ë²„íŠ¼ ëˆ„ë¥´ë©´ í˜¸ì¶œë˜ë„ë¡ êµ¬ì„±í•¨)

    /* =========================
       í™ˆ: ë¯¸ë¦¬ë³´ê¸°(ëœë¤) ë¡œë”©
       ========================= */
    async function loadHomePreviews(){
      await loadQuestionPreview();   // ì§ˆë¬¸ 3ê°œ ëœë¤
      loadCampusPreview();           // ìº í¼ìŠ¤ 2ê°œ ëœë¤
      loadFoodPreview();             // ë§›ì§‘ 2ê°œ ëœë¤
    }

    // ë°°ì—´ ì…”í”Œ
    function shuffle(arr){ return [...arr].sort(()=>Math.random()-0.5); }

    // ì§ˆë¬¸ ë¯¸ë¦¬ë³´ê¸°: /categories -> /questions/{id}ë“¤ ëª¨ì•„ ëœë¤3
    async function loadQuestionPreview(){
      const ul = document.getElementById('preview-questions');
      ul.innerHTML = `<li class="item muted">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li>`;
      try{
        const catRes = await fetch(`${API_BASE}/categories`);
        const cats = (await catRes.json()).categories || [];
        const allQ = [];
        for(const c of cats){
          const qRes = await fetch(`${API_BASE}/questions/${c.id}`);
          const qs = (await qRes.json()).questions || [];
          // catIdë¥¼ ë¶™ì—¬ì„œ ë³´ê´€ (ë¯¸ë¦¬ë³´ê¸°ì—ì„œ í´ë¦­ ì‹œ ë°”ë¡œ ì „ìš© í˜ì´ì§€ì—ì„œ ì—´ê¸° ìœ„í•´)
          qs.forEach(q => allQ.push({ ...q, catId: c.id, catName: c.name }));
        }

        if(allQ.length===0){ ul.innerHTML = `<li class="item muted">ë“±ë¡ëœ ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</li>`; return; }

        const pick = shuffle(allQ).slice(0,3);
        ul.innerHTML = pick.map(q =>
          `<li class="item" onclick="showQuestionPage(${q.catId}, ${q.id})">${q.question}</li>`
        ).join('');
      }catch(e){
        console.error(e);
        ul.innerHTML = `<li class="item muted">âŒ ì§ˆë¬¸ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>`;
      }
    }

    // ìº í¼ìŠ¤ ë¯¸ë¦¬ë³´ê¸° (2ê°œ)
    function loadCampusPreview(){
      const ul = document.getElementById('preview-campus');
      const pick = shuffle(BUILDINGS).slice(0,2);
      ul.innerHTML = pick.map(b=>`<li class="item" onclick="showCampusPage(${b.id})">${b.name}</li>`).join('');
    }

    // ë§›ì§‘ ë¯¸ë¦¬ë³´ê¸° (2ê°œ)
    function loadFoodPreview(){
      const ul = document.getElementById('preview-food');
      const pick = shuffle(FOODS).slice(0,2);
      ul.innerHTML = pick.map(f=>`<li class="item" onclick="showFoodPage(${f.id})">${f.name}</li>`).join('');
    }

    /* =========================
       ì§ˆë¬¸ ì „ìš© í˜ì´ì§€
       ========================= */
    async function showQuestionPage(openCatId=null, openQId=null){
      showPage('page-questions');

      // ì¹´í…Œê³ ë¦¬ ë Œë”
      const catUl = document.getElementById('q-cat-list');
      catUl.innerHTML = `<li class="item muted">ì¹´í…Œê³ ë¦¬ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li>`;
      const res = await fetch(`${API_BASE}/categories`);
      const cats = (await res.json()).categories || [];
      catUl.innerHTML = cats.map(c => `<li class="item" onclick="loadQuestionList(${c.id})">${c.name}</li>`).join('');

      // íŠ¹ì • ì¹´í…Œê³ ë¦¬/ì§ˆë¬¸ì„ ë°”ë¡œ ì—´ì–´ë‹¬ë¼ê³  ìš”ì²­ëœ ê²½ìš°
      if(openCatId){
        await loadQuestionList(openCatId, openQId);
      }else{
        // ê¸°ë³¸: ì²« ë²ˆì§¸ ì¹´í…Œê³ ë¦¬ ë¡œë”©(ì„ íƒì€ ì‚¬ìš©ìê°€)
        document.getElementById('q-list-wrap').style.display='none';
      }
    }

    async function loadQuestionList(catId, openQId=null){
      const wrap = document.getElementById('q-list-wrap');
      const title = document.getElementById('q-current-cat');
      const ul = document.getElementById('q-list');

      // ì¹´í…Œê³ ë¦¬ëª… í‘œì‹œ
      try{
        const catRes = await fetch(`${API_BASE}/categories`);
        const cats = (await catRes.json()).categories || [];
        const cat = cats.find(c=>c.id===catId);
        title.textContent = cat ? `ì§ˆë¬¸ ëª©ë¡ â€” ${cat.name}` : 'ì§ˆë¬¸ ëª©ë¡';
      }catch{ title.textContent = 'ì§ˆë¬¸ ëª©ë¡'; }

      wrap.style.display='block';
      ul.innerHTML = `<li class="item muted">ì§ˆë¬¸ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</li>`;

      const qRes = await fetch(`${API_BASE}/questions/${catId}`);
      const qs = (await qRes.json()).questions || [];
      if(qs.length===0){
        ul.innerHTML = `<li class="item muted">ì•„ì§ ë“±ë¡ëœ ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</li>`; return;
      }

      ul.innerHTML = qs.map(q => `
        <li class="item" data-qid="${q.id}" onclick="toggleAnswer(event, ${q.id})">
          ${q.question}
        </li>
      `).join('');

      // íŠ¹ì • ì§ˆë¬¸ì„ ë°”ë¡œ í¼ì¹˜ê¸°
      if(openQId){
        const li = ul.querySelector(`li[data-qid="${openQId}"]`);
        if(li) toggleAnswer({currentTarget:li}, openQId, true);
      }
    }

    async function toggleAnswer(ev, qId, skipScroll=false){
      const li = ev.currentTarget || ev; // programmatic call ì§€ì›
      // ì´ë¯¸ ì—´ë ¤ìˆìœ¼ë©´ ë‹«ê¸°
      const opened = li.querySelector('.detail');
      if(opened){ opened.remove(); return; }

      // ë‹¤ë¥¸ í•­ëª©ë“¤ detail ë‹«ê¸°
      li.parentElement.querySelectorAll('.detail').forEach(x=>x.remove());

      // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
      const res = await fetch(`${API_BASE}/answer/${qId}`);
      const data = await res.json();

      const div = document.createElement('div');
      div.className = 'detail';
      div.innerHTML = `
        <p>${data.answer}</p>
        <div class="spacer"></div>
        <button class="btn" onclick="closeDetail(this)">ë‹«ê¸°</button>
      `;
      li.appendChild(div);

      if(!skipScroll){
        li.scrollIntoView({behavior:'smooth', block:'center'});
      }
    }
    function closeDetail(btn){
      btn.closest('.detail').remove();
    }

    /* =========================
       ìº í¼ìŠ¤ ì „ìš© í˜ì´ì§€
       ========================= */
    function showCampusPage(openId=null){
      showPage('page-campus');
      const ul = document.getElementById('campus-list');
      ul.innerHTML = BUILDINGS.map(b=>`
        <li class="item" data-bid="${b.id}" onclick="toggleBuilding(event, ${b.id})">${b.name}</li>
      `).join('');
      if(openId){
        const li = ul.querySelector(`li[data-bid="${openId}"]`);
        if(li) toggleBuilding({currentTarget:li}, openId, true);
      }
    }
    function toggleBuilding(ev, id, skipScroll=false){
      const li = ev.currentTarget || ev;
      const b = BUILDINGS.find(x=>x.id===id);
      const opened = li.querySelector('.detail');
      if(opened){ opened.remove(); return; }
      li.parentElement.querySelectorAll('.detail').forEach(x=>x.remove());
      const div = document.createElement('div');
      div.className = 'detail';
      div.innerHTML = `
        <p><strong>${b.name}</strong></p>
        <p>ğŸ“ ${b.address}</p>
        <p><a class="map-link" href="${b.link}" target="_blank">Google Mapsë¡œ ë³´ê¸° ğŸ”—</a></p>
        <div class="spacer"></div>
        <button class="btn" onclick="closeDetail(this)">ë‹«ê¸°</button>
      `;
      li.appendChild(div);
      if(!skipScroll){ li.scrollIntoView({behavior:'smooth', block:'center'}); }
    }

    /* =========================
       ë§›ì§‘ ì „ìš© í˜ì´ì§€
       ========================= */
    function showFoodPage(openId=null){
      showPage('page-food');
      const ul = document.getElementById('food-list');
      ul.innerHTML = FOODS.map(f=>`
        <li class="item" data-fid="${f.id}" onclick="toggleFood(event, ${f.id})">${f.name}</li>
      `).join('');
      if(openId){
        const li = ul.querySelector(`li[data-fid="${openId}"]`);
        if(li) toggleFood({currentTarget:li}, openId, true);
      }
    }
    function toggleFood(ev, id, skipScroll=false){
      const li = ev.currentTarget || ev;
      const f = FOODS.find(x=>x.id===id);
      const opened = li.querySelector('.detail');
      if(opened){ opened.remove(); return; }
      li.parentElement.querySelectorAll('.detail').forEach(x=>x.remove());
      const div = document.createElement('div');
      div.className = 'detail';
      div.innerHTML = `
        <p><strong>${f.name}</strong></p>
        <p>ğŸ“ ${f.address}</p>
        <p><a class="map-link" href="${f.link}" target="_blank">Google Mapsë¡œ ë³´ê¸° ğŸ”—</a></p>
        <div class="spacer"></div>
        <button class="btn" onclick="closeDetail(this)">ë‹«ê¸°</button>
      `;
      li.appendChild(div);
      if(!skipScroll){ li.scrollIntoView({behavior:'smooth', block:'center'}); }
    }
  </script>
</body>
</html>
